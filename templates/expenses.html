{% extends 'master/base.html' %}
{% block 'title' %}
Expense Summary
{% endblock %}


{% block 'css' %}



    <style>
            #myInput {
              font-size: 16px;
              padding: 12px 20px 12px 40px;
              border: 1px solid #ddd;
              margin-bottom: 12px;
            }
            #from_date {
              font-size: 16px;
              padding: 12px 20px 12px 40px;
              border: 1px solid #ddd;
              margin-bottom: 12px;
            }
            #to_date {
              font-size: 16px;
              padding: 12px 20px 12px 40px;
              border: 1px solid #ddd;
              margin-bottom: 12px;
            }
            .hiddenRow {
                padding: 0 4px !important;
                background-color: #eeeeee;
                font-size: 20px;
            }
            .accordian-body span{
                color:#a2a2a2 !important;
            }
            

    </style>

{% endblock %}



{% block 'content' %}
<div class="container pt-3">
    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'expenses_home' %}">Expenses</a></li>
      <li class="breadcrumb-item active" aria-current="page">Expense Summary</li>
    </ol>
  </nav>
</div>

         

    



<div class="container">

    <div class="row">

        <div class="col-sm-1"><input type="button" id='filterbutton' class="btn" onclick="filter()" style="margin-top: 20px; margin-bottom: 20px;" value="Filter"></div>
        
        <div class="col-sm-11">
            <div class="filter" id='filter'>

            <form method="GET" name='datefilter'>
                
                <div class="card" style="margin-bottom: 20px;">

                    <div class="row">
                        <div class="col-sm-4"><input type="text" name="from_date" id="from_date" placeholder="From Date" onfocus="(this.type='date')" onblur="(this.type='text')" onChange="datefilter.submit();" value="{{from_date}}" style="margin-top:20px;margin-left: 2vw;" ><br></div>
                        <div class="col-sm-4"><input type="text" name="to_date" id="to_date" placeholder="To Date" onfocus="(this.type='date')" onblur="(this.type='text')" onChange="datefilter.submit();" value="{{to_date}}" style="margin-top:20px;margin-left: 2vw;" ><br></div>
                        <div class="col-sm-4"><input type="text" id="myInput" placeholder=" Search Category,title,..." onkeyup="searchTable()" style="margin-top:20px; margin-left: 2vw;" ></div>
                        <div class="col-sm-1"><input type="button"class="btn" value="Clear" id="clear" onclick="cleardate()" style=" margin-top: 25px; margin-bottom: 20px; margin-left: 2vw;"></div>
                    </div>
                    
                    
                </div>
                
 
            </form>
            
    
            </div>
        </div>
    </div>

    
    

    
    <div class="table-responsive">
    <table class="table table-hover table-bordered table-light" name="expensetable">
        <thead>
        <th>Category</th>
            <th>Title</th>
            <th>Date</th>
            <th>Cost </th>
            <th>Action</th>
        </thead>

        <tbody id="expensebody">
            {% for e in expenses %}
                        <tr colspan="6" data-toggle="collapse" data-target="#{{e.id}}" class="accordion-toggle">
                            <td>{{e.category}}</td>
                            <td>{{e.title}}</td>
                            <td>{{e.date}}</td>
                            <td class="amount">{{e.costs}}</td>
                            <td><a href="#" onclick="_edit('{% url 'exp_edit' e.id %}')">e</a>|<a href="#" onclick="_delete('{% url 'exp_delete' e.id %}')">d</a> </td>
                            

                        </tr>
                        <tr class="p">
                            <td colspan="6" class="hiddenRow">
                                <div class="accordian-body collapse p-3" id="{{e.id}}">
                                    <p>Date : <span>{{e.date}}</span> </p>
                                    <p>Day : <span>{{e.date|date:'l'}}</span> </p>
                                    <p>Category : <span>{{e.category}}</span> </p>
                                    <p>Name : <span>{{e.title}}</span> </p>
                                    <p>Cost : <span>Rs.{{e.costs}}</span></p>
                                    <p>Description : <span>{{e.description}}</span></p>
                                </div>
                            </td>
                        </tr>
            {% endfor %}

        </tbody>
        <tfoot>
            <th colspan="3">Total(in Rs.)</th><td colspan="2" id="total"></td>
        </tfoot>
    </table>
  </div>
    
    

</div>


    <script>
         function _delete(url){
         bootbox.confirm("Confirmation to delete?", function(result){
            if(result){
                window.location.href=url
                }
         });
        }
        function _edit(url){
         bootbox.confirm("Confirmation to edit?", function(result){
            if(result){
                window.location.href=url
                }
         });
        }

        $('.accordion-toggle').click(function(){
        $('.hiddenRow').hide();
        $(this).next('tr').find('.hiddenRow').show();
        });

    function searchTable() {
  var input, filter, found, table, tr, td, i, j;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("expensebody");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td");
    for (j = 0; j < td.length; j++) {
      if (td[j].innerHTML.toUpperCase().indexOf(filter) > -1) {
        found = true;
      }
    }
    if (found) {
      tr[i].style.display = "";
      found = false;
    } else {
      tr[i].style.display = "none";
    }
  }
  var cls = document.getElementById("expensebody").getElementsByTagName("td");
  var sum = 0;
  for (var i = 0; i < cls.length; i++) {
    // Here you check if it's a countable class and the parent tr's style is a visible tr
    if (cls[i].className == "amount" && cls[i].closest("tr").style.display != "none") {
      sum += isNaN(cls[i].innerHTML) ? 0 : parseFloat(cls[i].innerHTML);
    }
  }
  document.getElementById('total').innerHTML = sum;

}
var cls = document.getElementById("expensebody").getElementsByTagName("td");
var sum = 0;
for (var i = 0; i < cls.length; i++) {
  if (cls[i].className == "amount") {
    sum += isNaN(cls[i].innerHTML) ? 0 : parseInt(cls[i].innerHTML);
  }
}
document.getElementById('total').innerHTML += sum;

    //for filter button
    function filter() {
        var x = document.getElementById("filter");
        // document.getElementById("filterbutton").value="Clear";
        
        if (x.style.display === "none") {
            x.style.display = "block";           
            
            
        } else {
            x.style.display = "none"; 
             
                   
                       
        }
        }
        function cleardate(){
            document.getElementById("from_date").value="";
            document.getElementById("to_date").value=""; 
            datefilter.submit();
        }

       
</script>


{% endblock %}
