<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw==" crossorigin="anonymous"></script>
    

    <title>ExpenseTracker</title>
    
</head>
<body>

    <nav class="navbar sticky-top navbar-expand-lg navbar-light" style="background-color:#85bb65; background: rgba(133, 187, 101);">
        <a class="navbar-brand" href="{% url 'dashboard' %}">ExpenseTracker</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">

          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">

            <li class="nav-item">
              <a class="nav-link" href="{% url 'income_home' %}">Income <span class="sr-only">(current)</span></a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="{% url 'expenses_home' %}">Expense</a>
            </li>
              <li class="nav-item">
              <a class="nav-link" href="{% url 'home' %}">Home</a>
            </li>

          </ul>

          <a href="{% url 'profile' %}"><button class="btn btn-outline-success my-2 my-sm-0" style="margin:5px;"  type="submit">Profile</button></a>

          <a href="{% url 'logout' %}"><button class="btn btn-outline-success my-2 my-sm-0" style="margin:5px;" type="submit">LogOut</button></a>

        </div>
    </nav>
    <div class="container pt-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">ExpenseTracker</a></li>
        <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
        </ol>
    </nav>
    </div>

    <div class="container">  
        <!-- DEtail row -->
    <div class="row">
        <!-- Detail Form -->
        <div class="col-md-6">

        <div class="card table-responsive" style="background: rgba(133, 187, 101, 0.1);width: 500; height: 60vh; margin-top: 10px; margin-bottom: 20px;">

            <div class="container" style="margin-top:20px; margin-bottom: 20px;">
                <form class="form" name="datefilter" method="POST">
    
                        {% csrf_token %}
                        <label>From Month:</label>
                        <input class="form-control input" type="text" name="from_month" placeholder="Select Month" id="from_month" onfocus="(this.type='month')" onblur="(this.type='text')" value="{{month}}" onChange="datefilter.submit();" required>
    
                                
                    </form>  
            </div>
    
            <div class="container">
    
                <fieldset>
    
                                <legend>
                                    Total Details:
                                </legend>
    
                                <label>Income:</label>
                                    <input class="form-control" id='income' type="number" name="income" value="{{total_income}}" readonly>
                                <label>Expenses:</label>
                                    <input class="form-control" id='expense' type="number" name="expense" value="{{total_expenses}}" readonly>
                                <label>Savings:</label>
                                    <input class="form-control" id='saving' type="number" name="savings" value="{{total_savings}}" readonly>
    
                                <div class="container pt-3"><a href="{% url 'home' %}"><button class="btn btn-primary" value="Add Data">ADD DATA</button></a></div>
    
                </fieldset>
    
    
    
            </div> 

        </div>

        </div>
        <!-- Detail Chart -->
        <div class="col-md-6">
            <div class="card" style="width: 500; height: 60vh; margin-top: 10px; margin-bottom: 20px;">
            
                <canvas id="details"></canvas>
            
            </div>
        </div>

    </div>   

    </div>

    <div class="container">
        <!-- expense/income chart row -->
        <div class="row">
        <!-- expense chart -->
        <div class="col-md-6">
    
            <div class="card" style="width: 500; height: 60vh; margin-top: 10px; margin-bottom: 20px;">
            <canvas id="expenseChart"></canvas>
            </div>
    
        </div>
            <!-- income chart -->
            <div class="col-md-6">
            <div class="card" style="width: 500; height: 60vh; margin-top: 10px; margin-bottom: 20px;">            
                <canvas id="incomeChart"></canvas>            
            </div>
            </div>
    
        </div>   
    
    </div>
    


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="{% static 'js/bootbox.min.js' %}"></script>

<script>

        const rendermonthlydetailChart=(monthlist,expenselist,incomelist,savingslist) => {  
            var ctx = document.getElementById('details').getContext('2d');
                var detailChart = new Chart(ctx, {
                    type: 'bar',
                    //data_start
                    data: {
                        labels:monthlist,
                        datasets: [
                                    {
                                    label: 'Expenses',
                                    data:expenselist,
                                    backgroundColor: 'rgba(255, 99, 132, 0.75)',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    borderWidth: 2
                                },
                                {
                                    label: 'Income',
                                    data:incomelist ,
                                    backgroundColor: 'rgba(54, 162, 235, 0.75)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 2
                                },
                                {
                                    label: 'Savings',
                                    data:savingslist ,
                                    backgroundColor: 'rgba(255, 206, 86, 0.75)',
                                    borderColor: 'rgba(255, 206, 86, 1)',
                                    borderWidth: 2
                                }
                                ]
                    },
                        //data_end,option_start
                    options: {
                        title:{
                        display:true,
                        text:'Money Details in year '+'2021'
                        },
                        legend:{
                            display:true,
                            position:'bottom'
                        },
                        responsive:true,
                        maintainAspectRatio:false,
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        }
                    }//option_end                
                }
            );
        }

        const renderexpenseChart=(category,expense) => {
                var ctx = document.getElementById('expenseChart').getContext('2d');
                var detailChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels:category,
                        datasets: [{
                            label: 'Expense Detail',
                            data:expense,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.75)',
                                'rgba(54, 162, 235, 0.75)',
                                'rgba(255, 206, 86, 0.75)',
                                'rgba(75, 192, 192, 0.75)',
                                'rgba(153, 102, 255, 0.75)',
                                'rgba(255, 159, 64, 0.75)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        title:{
                        display:true,
                        text:'Expenses Detail'
                        },
                        legend:{
                            display:true,
                            text:'Expense Detail',
                            position:'bottom',
                            align:'center'                     
                        

                        },
                        responsive:true,
                        maintainAspectRatio:false
                        
                    },                
                });
        }

        const renderincomeChart=(source,income) => {
            var ctx = document.getElementById('incomeChart').getContext('2d');
            var detailChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels:source,
                    datasets: [{
                        label: 'Income Detail',
                        data:income ,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.75)',
                            'rgba(54, 162, 235, 0.75)',
                            'rgba(255, 206, 86, 0.75)',
                            'rgba(75, 192, 192, 0.75)',
                            'rgba(153, 102, 255, 0.75)',
                            'rgba(255, 159, 64, 0.75)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    title:{
                    display:true,
                    text:'Income Detail'
                    },
                    legend:{
                        display:true,
                        text:'Income Detail',
                        position:'bottom',
                        align:'center'                     
                    

                    },
                    responsive:true,
                    maintainAspectRatio:false
                    
                },                
            });
        }
            



        const getmonthlyChartData =() =>{
                    var monthlist={{month_list|safe}};
                    var expenselist={{expenses_list|safe}};
                    var incomelist={{incomes_list|safe}};
                    var savingslist={{savings_list|safe}};
                rendermonthlydetailChart(monthlist,expenselist,incomelist,savingslist)
        }


        const getexpenseChartData = () => {
                    const data2={{expenses|safe}};           
                    var category = Object.keys(data2)
                    var expense = Object.values(data2)
                renderexpenseChart(category,expense)              
            };

        const getincomeChartData = () => {
                    const data3={{incomes|safe}};               
                    var source = Object.keys(data3)
                    var income = Object.values(data3) 
                renderincomeChart(source,income)             
            };
            
        function mycharts() {    
                getmonthlyChartData();
                getexpenseChartData();
                getincomeChartData();
        }


      document.onload = mycharts();
</script>
</body>
</html>


